{% extends "/base.html" %}
{% set active_page = "applications" %}
{% set active_app  = app.short_name %}
{% import "applications/_helpers.html" as helper %}

{% block content %}
{% from "_formhelpers.html" import render_field %}
{{ helper.render_loading(loading_text) }}
<div class="row">
    <div class="span3">
        {{ helper.render_app_local_nav(app, 'tasks', current_user)}}
    </div>
    <div class="span9">
        <h1><strong>{{app.name}}</strong>: {{_('Import tasks')}}</h1>
        <h2>{{_('From a Flickr set')}}</h2>
        {% if not albums %}
            {{ _('Grant Crowdcrafting access to your Flickr albums to select one...') }}
        <a href="{{ url_for('flickr.login', next=url_for(target, short_name=app.short_name, type='flickr')) }}" class="btn btn-secondary">{{ _('Log in Flickr') }}</a>
        {% else %}
            {{ _('Select one of your albums:') }}
            <ul>
            {% for album in albums %}
                <li>
                    <h5>{{ album['title'] }}</h5>
                    <p>{{ album['photos'] }} {{ _('photos') }}</p>
                    <img src="{{ album['thumbnail_url'] }}">
                    <button id="{{ album['id'] }}" class="btn btn-default btn-album">{{ _('Select') }}</button>
                </li>
            {% endfor %}
            </ul>
            <a href="{{ url_for('flickr.logout', next=url_for(target, short_name=app.short_name, type='flickr')) }}" class="btn btn-secondary">{{ _('Revoke access') }}</a>
        {% endif %}
        <br>
        {% if form %}
        <form class="form-horizontal" method="post" action="{{ url_for(target, short_name=app.short_name) }}">
            <fieldset>
                {{ form.hidden_tag() }}
                <span class="help-inline"> {{ _('Or manually provide the ID of a Flickr set with images for') }} {{ active_app }}. <br/> {{ _('For more information, please look at') }} <a href="http://docs.pybossa.com/en/latest/user/overview.html#importing-the-tasks-from-a-flickr-photo-set" target="_blank">{{ _('the documentation') }}.</a></span>
                {{ render_field(form.album_id, class_="input-block-level", placeholder="The ID of the Flickr set") }}
                <div class="form-actions">
                    <input id="submit" type="submit" value="{{_('Import')}}" class="btn btn-primary" />
                    <a href="{{ url_for('app.settings', short_name=app.short_name) }}" class="btn">{{_('Cancel')}}</a>
                </div>
            </fieldset>
        </form>
        {% endif %}
    </div>
</div>
<script>
    $("#submit").off('click').on('click', function(){
        $("#loading").show();
    });
</script>
{% endblock %}