{% include "urgentactions/ua-sub-header.html" %}

<script type="text/javascript" src="{{url_for('static', filename='js/attrchange.js')}}"></script>
<script type="text/javascript">
    function onElementHeightChange(elm, callback) {
        var lastHeight = elm.clientHeight, newHeight;
        (function run() {
            newHeight = elm.clientHeight;
            if (lastHeight != newHeight)
                callback();
            lastHeight = newHeight;

            if (elm.onElementHeightChangeTimer)
                clearTimeout(elm.onElementHeightChangeTimer);

            elm.onElementHeightChangeTimer = setTimeout(run, 200);
        })();
    }

    $(function () {
        $(".one-person").click(function () {
            document.onmouseup = gText;
            if (!document.all) document.captureEvents(Event.MOUSEUP);
        });

        var t = '';
        var content_div_height = $('#task-presenter-div').height();
        $(".ua-sidebar").css("height", content_div_height + "px");
        var refreshIntervalId = setInterval(function () {
            var content_div_height_changed = $('#task-presenter-div').height();
            if (content_div_height == content_div_height_changed) {
                $(".ua-sidebar").css("height", content_div_height_changed + "px");
            } else {
                content_div_height = content_div_height_changed;
                $(".ua-sidebar").css("height", content_div_height + "px");
                clearInterval(refreshIntervalId);
            }
        }, 200);

        $("#close-popup").click(function () {
            $('#detailed-individual-information').hide();
        });

        function getSelectedText() {
            if (window.getSelection) {
                return window.getSelection().toString();
            } else if (document.selection) {
                return document.selection.createRange().text;
            }
            return '';
        }

        function gText(e) {
            t = (document.all) ? document.selection.createRange().text : document.getSelection();
            var sel = getSelection(),
                    position = sel.anchorNode.compareDocumentPosition(sel.focusNode),
                    backward = false;

            var selText = getSelectedText(),
                    targetElem = e.target.tagName.toLowerCase();
            if (selText && targetElem == 'p') {
                if (click == 1) {
                    if (t != "") {
                        var length = t.toString().length;
                        $('#detailed-individual-information').hide();
                        $('#detailed-individual-information').css({
                            'top': e.pageY - 195,
                            'position': 'absolute',
                            'width': 240,
                            'color': '#fff',
                            'border': '1px solid #333',
                            'padding': '5px',
                            'background-color': "#333333"
                        });
                        person_name = t.toString();
                        if (!position && sel.anchorOffset > sel.focusOffset ||
                                position === Node.DOCUMENT_POSITION_PRECEDING) {
                            backward = true;
                            $('#detailed-individual-information').css({
                                'left': e.pageX + length
                            });
                        } else {
                            $('#detailed-individual-information').css({
                                'left': e.pageX - length * 4
                            });
                        }

                        $("#person-name").html(t + "<br><i>Is this the full and correct name?</i>")

                        if (screen_width > 768) {
                            $('#detailed-individual-information').show();
                        }
                    }
                }
            }
        }

    });
</script>
<div class="row presenter-container" style="color: #000; background-color: #fff;">
    <div class="col-md-2 ua-sidebar"></div>
    <div class="col-xs-12 col-md-8" id="task-presenter-div" style="padding: 0 14px 0 14px;">
        <script>
            Modernizr.load({
                test: window.JSON,
                nope: "{{url_for('static', filename='js/vendor/json2.min.js')}}"
            });
        </script>
        <script src="{{url_for('static', filename='js/pybossa/pybossa.js')}}" type="text/javascript"></script>
        <div class="row" style="position: relative;">
            <div class="finish-scene" style="display: none;">
                <div class="circle-base circle1">
                    <h1>YOU'RE AWESOME</h1>
                    <hr class="hr" style="margin-top: 0; width: 90%; background-color: #fff;">
                    <div class="sharing-buttons rrssb-buttons">
                        <h3 style="margin-top: -5px;">Please share</h3>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=http://altclick-test.focallabs.co.uk/"
                           class="popup" style="height: 65px;">
                            <i class="fa fa-facebook-square fa-4x"
                               aria-hidden="false"></i>
                        </a>
                        <a href="https://twitter.com/intent/tweet?text=Lorem%20Ipsum%20%2Fplacehold.it/350x150"
                           class="popup" style="margin-left: 5px !important">
                            <i class="fa fa-twitter-square fa-4x"
                               aria-hidden="false"></i>
                        </a>
                    </div>
                </div>
                {% if current_user.is_authenticated() %}
                <div class="task-counter action-counter">2 ACTIONS COMPLETED</div>
                {% else %}
                <div class="task-counter"><a style="color: #fff;" href="{{ url_for('account.signin') }}">Sign in to
                    track your progress.</a></div>
                {% endif %}
            </div>
            <div class="span12">
                <div class="skip btn-submit" id="skip">
                    <h5>Skip this urgent action</h5>
                </div>
                <br>
                <a href="{{url_for('project.details', short_name=project.short_name)}}" style="float: left;">
                    <div class="span4">
                        <img src="/static/img/urgent_action.png" style="margin-left: -5px;"
                             class="img img-responsive">
                    </div>
                </a>
                <div>
                    <h1 class="country-date"></h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="span12">
                <hr class="hr" style="margin: 20px 0 0 2px;">
            </div>
        </div>
        {% if invite_new_volunteers %}
        <div class="row">
            <div class="col-md-12">
                <p>
                    {{ _("Sorry, you've contributed to all the tasks for this project, but this project still needs
                    more
                    volunteers, so please spread the word!") }}
                </p>
            </div>
        </div>
        {% endif %}
        {{ project.info.task_presenter|safe }}

        <div id='PYBOSSA_USER_LOCALE' hidden>
            {% if current_user.is_anonymous() %}
            en
            {% else %}
            {{ current_user.locale }}
            {% endif %}
        </div>
        <br><br>
    </div>
    <div class="col-md-2 ua-sidebar"></div>
</div>
<div class="rectangle-speech-border" id="detailed-individual-information" style="display: none;">
    <div class="detailed-information">
        <h3 style="margin-top: 3px;" id="person-name"></h3>
        <div class="individual-outcome" id="confirm-name">CORRECT</div>
        <div class="individual-outcome" id="close-popup">CANCEL</div>
    </div>
</div>