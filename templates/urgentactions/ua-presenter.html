{% include "urgentactions/ua-sub-header.html" %}
<script type="text/javascript">
    $(function () {

        $(window).resize(function(){
            var mainDiv = document.getElementById("presenterContainer");
            var coord_sel = getSelectionCharOffsetsWithin(mainDiv);
            alert(coord_sel.start + ": " + coord_sel.end);

            $('#detailed-individual-information').css({
                position:'absolute',
                  top: coord_sel.start,
                  left:coord_sel.end
            });
//            if ($(window).width() < 980) {
//                $('#nav-head').removeClass('navbar-fixed-top');
//            }
//            else {
//                $('#nav-head').addClass('navbar-fixed-top');
//            }

        });
//        if ($(window).width() < 980) {
//            $('#nav-head').removeClass('navbar-fixed-top');
//        }
//        else {
//            $('#nav-head').addClass('navbar-fixed-top');
//        }



        $(".one-person").click(function () {
            document.onmouseup = gText;
            if (!document.all) document.captureEvents(Event.MOUSEUP);
        });

        var t = '';

        $("#close-popup").click(function () {
            $('#detailed-individual-information').hide();
        });

        function getSelectedText() {
            if (window.getSelection) {
                return window.getSelection().toString();
            } else if (document.selection) {
                return document.selection.createRange().text;
            }
            return '';
        }

        function gText(e) {
            t = (document.all) ? document.selection.createRange().text : document.getSelection();
            var sel = getSelection(),
                    position = sel.anchorNode.compareDocumentPosition(sel.focusNode),
                    backward = false;


            var selText = getSelectedText(),
                    targetElem = e.target.tagName.toLowerCase();
            if (selText && targetElem == 'p') {
                if (click == 1) {
                    if (t != "") {
                        var length = t.toString().length;
                        $('#detailed-individual-information').hide();
                        $('#detailed-individual-information').css({
                            'top': e.pageY - 195,
                            'position': 'absolute',
                            'width': 240,
                            'color': '#fff',
                            'border': '1px solid #333',
                            'padding': '5px',
                            'background-color': "#333333"
                        });
                        person_name = t.toString();
                        if (!position && sel.anchorOffset > sel.focusOffset ||
                                position === Node.DOCUMENT_POSITION_PRECEDING) {
                            backward = true;
                            $('#detailed-individual-information').css({
                                'left': e.pageX + length
                            });
                        } else {
                            $('#detailed-individual-information').css({
                                'left': e.pageX - length * 4
                            });
                        }

                        $("#person-name").html("<i>" +'"'+ capitalizeCase(person_name) +'"' +"</i>" + "<br><i>Is this the full and correct name?</i>");

                        if (screen_width > 768) {
                            $('#detailed-individual-information').show();
                        }
                    }
                }
            }
        }

    });


    function getSelectionCharOffsetsWithin(element) {
        var start = 0, end = 0;
        var sel, range, priorRange;
        if (typeof window.getSelection != "undefined") {
            range = window.getSelection().getRangeAt(0);
            priorRange = range.cloneRange();
            priorRange.selectNodeContents(element);
            priorRange.setEnd(range.startContainer, range.startOffset);
            start = priorRange.toString().length;
            end = start + range.toString().length;
        } else if (typeof document.selection != "undefined" &&
                (sel = document.selection).type != "Control") {
            range = sel.createRange();
            priorRange = document.body.createTextRange();
            priorRange.moveToElementText(element);
            priorRange.setEndPoint("EndToStart", range);
            start = priorRange.text.length;
            end = start + range.text.length;
        }
        return {
            start: start,
            end: end
        };
    }
function capitalizeCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}
</script>
<div class="row presenter-container" id="presenterContainer" style="color: #000; background-color: #fff;">
    <div class="col-md-2 ua-sidebar"></div>
    <div class="col-xs-12 col-md-8" id="task-presenter-div" style="padding: 0 14px 0 14px;">
        <script>
            Modernizr.load({
                test: window.JSON,
                nope: "{{url_for('static', filename='js/vendor/json2.min.js')}}"
            });
        </script>
        <script src="{{url_for('static', filename='js/pybossa/pybossa.js')}}" type="text/javascript"></script>
        <div class="row" style="position: relative;">
            <div class="finish-scene" style="display: none;">
                <div class="circle-base circle1">
                    <h1>YOU'RE AWESOME</h1>
                    <hr class="hr" style="margin-top: 0; width: 90%; background-color: #fff;">
                    <div class="sharing-buttons rrssb-buttons">
                        <h3 style="margin-top: -5px;">Please share</h3>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=http://altclick-test.focallabs.co.uk/"
                           class="popup" style="height: 65px;">
                            <i class="fa fa-facebook-square fa-4x"
                               aria-hidden="false"></i>
                        </a>
                    <a href="http://twitter.com/share?url=http://altclick-test.focallabs.co.uk/&amp;text=Join hundreds of digital volunteers helping us expose human rights violations http://decoders.amnesty.org"
                           class="popup" style="margin-left: 5px !important">
                            <i class="fa fa-twitter-square fa-4x"
                               aria-hidden="false"></i>
                        </a>
                    </div>
                </div>
                {% if current_user.is_authenticated() %}
                <div class="task-counter action-counter">2 ACTIONS COMPLETED</div>
                {% else %}
                <div class="task-counter"><a style="color: #fff;" href="{{ url_for('account.signin') }}">Sign in to
                    track your progress.</a></div>
                {% endif %}
            </div>
            <div class="span12">
                <div class="skip btn-submit" id="skip">
                    <h5>Skip this urgent action</h5>
                </div>
                <br>
                <a href="{{url_for('project.details', short_name=project.short_name)}}" style="float: left;">
                    <div class="span4">
                        <img src="/static/img/urgent_action.png" style="margin-left: -5px;"
                             class="img img-responsive">
                    </div>
                </a>
                <div>
                    <h1 class="country-date"></h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="span12">
                <hr class="hr" style="margin: 20px 0 0 2px;">
            </div>
        </div>
        {% if invite_new_volunteers %}
        <div class="row">
            <div class="col-md-12">
                <p>
                    {{ _("Sorry, you've contributed to all the tasks for this project, but this project still needs
                    more
                    volunteers, so please spread the word!") }}
                </p>
            </div>
        </div>
        {% endif %}
        {{ project.info.task_presenter|safe }}

        <div id='PYBOSSA_USER_LOCALE' hidden>
            {% if current_user.is_anonymous() %}
            en
            {% else %}
            {{ current_user.locale }}
            {% endif %}
        </div>
        <br><br>
    </div>
    <div class="col-md-2 ua-sidebar"></div>
</div>
<div class="rectangle-speech-border" id="detailed-individual-information" style="display: none;">
    <div class="detailed-information">
        <h3 style="margin-top: 3px;" id="person-name"></h3>
        <div class="individual-outcome" id="confirm-name">CORRECT</div>
        <div class="individual-outcome" id="close-popup">CANCEL</div>
    </div>
</div>